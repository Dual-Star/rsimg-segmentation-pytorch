## author: xin luo, 
## created: 2023.4.2
## configure parameters for the model training

import torch
import torch.nn as nn
from dataloader.img_aug import rotate, flip, torch_noise, colorjitter, numpy2tensor
from glob import glob


dir_proj = '/home/xin/Developer-luo/rsimg-segmentation-pytorch'

#### ------------- Model -------------
model_name = 'deeplabv3plus'   ### option: unet, deeplabv3plus, deeplabv3plus_mobilev2, hrnet, gmnet

#### ------------- Directories/files -------------
dir_scene = 'data/s1-dset/s1as-scene'
dir_truth = 'data/s1-dset/s1-truth'
### --- validation data
dir_val_patch = 'data/s1-dset/s1as-val-patch'            ## single scale patch input, generated by notebooks/dset_val_patch.ipynb
# dir_val_patch = 'data/s2-dset/s1as-val-patch-scales'   ## multiscale patch input, generated by notebooks/dset_val_patch.ipynb
### --- train data
paths_scene_tra = sorted(glob(dir_scene+'/*.tif'))[10:]        ## scenes for training (excluding the first 10 validation scenes)
paths_truth_tra = sorted(glob(dir_truth+'/*.tif'))[10:]        ## truth for training
### --- path to save
model_save_name = model_name+'_trained'
path_weights_save = dir_proj + '/model_trained/' + model_save_name+'_weights.pth'
path_metrics_save = dir_proj + '/model_trained/' + model_save_name + '_metrics.csv'
### --- number of bands of the image.
num_bands = 2

#### ------------- Training parameters -------------
patch_size = [256]   ### single scale (e.g., [256]) or multiple scale (e.g., [2048, 512, 256]) patch size. 
num_thread_data_load = 30
num_epoch = 200

# min_img, max_img = 0, 10000   ## used for s2 image normalization
max_img, min_img = [30.61*100, 13.71*100], [-63.0*100, -70.37*100]   ### For s1as image normalization
lr = 0.0002           ## if use lr_scheduler;
batch_size_tra = 32   ## 
batch_size_val = 16   ## 
loss_bce = nn.BCELoss()    # selected for binary classification

## ------------- Data tranform/augmentation -------------
transforms_tra = [
        colorjitter(prob=0.25, alpha=0.05, beta=0.05),    # numpy-based, !!!beta should be small
        rotate(prob=0.25),           # numpy-based
        flip(prob=0.25),             # numpy-based
        numpy2tensor(), 
        torch_noise(prob=0.25, std_min=0, std_max=0.1),      # tensor-based
            ]

